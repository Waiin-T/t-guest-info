<!--<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="bower_components/paper-item/paper-item.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/iron-media-query/iron-media-query.html">-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
 <!-- <link rel="import" href="../neon-animation/web-animations.html"> -->

<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-media-query/iron-media-query.html">
<link rel="import" href="t-traveler-info.html">
<link rel="import" href="t-loyalty-program.html">

<dom-module id="t-guest-info">
  <template>
    <style>
       :host {
        display: block;
        background-color: white;
      }

      #travelerInfo {
        margin-top: 40px;
      }

      #toolbar1 {
        background-color: transparent;
        border: 1px solid lightgray;
        margin: 10px;
        color: #478BD7;
        height: 60px;
      }

      #signInLink {
        color: #478BD7;
        text-decoration: none;
        font-size: 16px;
      }


      .item[smallMobileView] #toolbarLotalty {
        background-color: var(--toolbar-background-color);
        width: 100%;
        height: 50px;
        margin-left: -14px;
      }

      .item[smallMobileView] #loyaltyDiv {
        width: 100%;
      }

      .item[smallMobileView] #addProgramForOtherGuestButton {
        color: var(--color-for-button-labels);
        margin-left: -13px;
        float: left;
        margin-top: 3%;
        padding-bottom: 30px;
      }

      .item[smallMobileView] #lineBreakBetweenProduct {
        margin-top: 74px;
        clear: both;
        margin-left: -4px;
      }

      .item[mobileView] #toolbarLotalty {
        background-color: var(--toolbar-background-color);
        width: 100%;
        height: 50px;
        margin-left: -14px;
      }

      .item[mobileView] #loyaltyDiv {
        width: 100%;
        margin-top: 10px;
      }

      .item[mobileView] #addProgramForOtherGuestButton {
        color: var(--color-for-button-labels);
        margin-left: -13px;
        float: left;
        margin-top: 3%;
        padding-bottom: 30px;
      }

      .item[mobileView] #tLoyaltyProgram {}

      .item[tabletView] #toolbarLotalty {
        background-color: var(--toolbar-background-color);
        width: 97%;
        height: 50px;
        margin-left: -5px;
      }

      .item[mobileView] #lineBreakBetweenProduct {
        margin-top: 74px;
        clear: both;
        margin-left: -4px;
      }

      .item[tabletView] #loyaltyDiv {
        width: 100%;
      }

      .item[tabletView] #addProgramForOtherGuestButton {
        color: var(--color-for-button-labels);
        margin-left: 50px;
        float: left;
        margin-top: 3%;
        padding-bottom: 30px;
      }

      #loyaltyDiv {
        width: 67%;
      }

      #toolbarLotalty {
        font-size: 16px;
        background-color: var(--toolbar-background-color);
        width: 97%;
        margin-left: 10px;
        margin-top: 20px;
        height: 50px;
      }

      #tLoyaltyDatabase {
        margin-top: 2%;
      }

      #addProgramForOtherGuestButton {
        color: var(--color-for-button-labels);
        margin-left: 6px;
        float: left;
        margin-top: 3%;
        padding-bottom: 30px;
      }

      #lineBreakBetweenProduct {
        margin-top: 74px;
        clear: both;
        margin-left: 10px;
      }

      .item[smallMobileView] #buttonRemove {
        margin-left: 10px;
        margin-top: 20px;
      }

      .item[mobileView] #buttonRemove {
        margin-left: 15px;
        margin-top: 6%;
      }

      .item[tabletView] #buttonRemove {
        margin-top: 5%;
        margin-left: 20px;
      }

      #buttonRemove {
        margin-top: 4%;
        margin-left: 65px;
        width: 60px;
        color: var(--color-for-button-labels);
        font-weight: 450;
      }
    </style>
    <iron-media-query query="(max-width: 380px)" query-matches="{{smallMobileView}}"></iron-media-query>
    <iron-media-query query="(min-width: 380px) and (max-width:767px)" query-matches="{{mobileView}}"></iron-media-query>
    <iron-media-query query="(min-width: 768px) and (max-width:1023px)" query-matches="{{tabletView}}"></iron-media-query>
    <iron-media-query query="(min-width: 1024px) and (max-width: 1200px)" query-matches="{{desktopView}}"></iron-media-query>
    <iron-media-query query="(min-width: 1200px)" query-matches="{{largeDesktopView}}"></iron-media-query>
    <iron-media-query query="(max-width: 600px)" query-matches="{{mediumTablet}}"></iron-media-query>
    <iron-media-query query="(max-width: 767px)" query-matches="{{mobilePhone}}"></iron-media-query>
    <div class="item" smallMobileView$="{{smallMobileView}}" desktopView$="{{desktopView}}" tabletView$="{{tabletView}}" mobileView$="{{mobileView}}">
<!-- 
      <app-toolbar id="toolbar1"><a href="#" id="signInLink">Sign in to make booking faster</a></app-toolbar>
      <br /> -->

      <template is="dom-repeat" items="{{product}}" as="product" index-as="productNo">
        <template is="dom-repeat" items="{{product.rooms}}" as="room">

          <t-traveler-info id="travelerInfo{{_increaseIndex(productNo)}}{{_increaseIndex(index)}}" title="{{title}} {{_increaseIndex(index)}}"
            sub-title="{{room.name}} | {{room.criteria.traveler.adult}} Adults, {{room.criteria.traveler.child}} Child" policy-List="{{room.policies}}"
            parent="{{product}}" room-number="{{_increaseIndex(index)}}" pax-list="{{paxlist}}" option="[[option]]"
            resources="{{resources}}" adult-pax-count="[[room.criteria.traveler.adult]]" child-pax-count="[[room.criteria.traveler.child]]"
            guest-info="{{guestInfo}}" only-lead-pax-info="{{room.onlyLeadPaxInfo}}" pax-list-available="{{paxlistAvailable}}">
          </t-traveler-info>
          <br>
        </template>

        <div id="loyaltyDiv" hidden$={{!product.allowLoyalty}}>
          <app-toolbar id="toolbarLotalty">Loyalty program</app-toolbar>
          <template is="dom-repeat" items="{{loyaltyPrograms}}">
            <div id="tLoyaltyProgram">
              <t-loyalty-program id="tLoyaltyDatabase{{_increaseIndex(index)}}" pax-list="{{paxlist}}" index="{{_increaseIndex(productNo)}}">{{ item.loyaltyProgram }}</t-loyalty-program>
              <div id="buttonRemoveDiv" hidden$=[[_isRemoveButtonHidden]]>
                <paper-button id="buttonRemove" on-tap="_deleteLoyaltyProgram">Remove</paper-button>
              </div>
            </div>
          </template>
          <div>
            <paper-button id="addProgramForOtherGuestButton" on-tap="_addProgramForOtherGuest">Add program for other guest</paper-button>
            <br />
          </div>
        </div>
        <hr id="lineBreakBetweenProduct">
      </template>

      <br>
      <br>
    </div>
  </template>

  <script>
    /**
     * `t-guest-info`
     * 
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class TGuestInfo extends Polymer.Element {

      static get is() {
        return 't-guest-info';
      }
      static get properties() {
        return {
          guestInfo: Object,
          loyaltyPrograms: {
            type: Array,
            notify: true,
            value: []
          },
          loyaltyProgramIds: {

            type: Array,
            value: []
          },
          _isRemoveButtonHidden: {
            type: Boolean,
            computed: '_lte(loyaltyPrograms.length , 1)'
          },
          onlyLeadPaxInfo: {
            type: Boolean,
            value: true
          },
          smallMobileView: {
            type: Boolean,
            value: false
          },
          mobileView: {
            type: Boolean,
            value: false
          },
          tabletView: {
            type: Boolean,
            value: false
          },
          desktopView: {
            type: Boolean,
            value: false
          },
          largeDesktopView: {
            type: Boolean,
            value: false
          },
          title: {
            type: String,
            value: 'Room'
          },
          subTitle: {
            type: String,
          },
          adultPaxCount: {
            type: Number
          },
          childPaxCount: {
            type: Number
          },
          paxlist: {
            type: Array,
            value: [],
            notify: true
          },
          policyList: {
            type: Array
          },

          option: {
            type: Object,
            value: {
              "requiredField": [],
              "requiredFieldForLeadPax": []
            }
          },
          resources: {
            type: Object
          },
          product: {
            type: Object,
            value: {
              "rooms": []
            }
          },
          paxlistAvailable: {
            type: Boolean,
            value: false
          },
        };
      } //End of Properties.

      _updatePaxList(paxlist) {
        // console.log(paxlist);
        return paxlist;
      }
      _lte(loyaltyProgramAdultLength, hiddenButtonAdultNumber) {
        return loyaltyProgramAdultLength <= hiddenButtonAdultNumber;
      }
      _addProgramForOtherGuest(loyaltyProgram) {
        // this._loyaltyProgramData();
        // if(this.loyaltyPrograms.length < this.paxlist.length){
        var copy = Object.assign({}, {loyaltyProgram: ""})
        var ind = this.push('loyaltyPrograms', copy);
        setTimeout(() => {
          var loyaltyProgramID = this.shadowRoot.querySelector("#tLoyaltyDatabase" + ind).id;
          // console.log(this.loyaltyProgramIds);
          this.push('loyaltyProgramIds', loyaltyProgramID);
        }, 1);

        // }
        // if(this.loyaltyPrograms.length === this.paxlist.length)
        // {
        //   this.shadowRoot.querySelector("#addProgramForOtherGuestButton").style.visibility = 'hidden';
        // }
        // console.log(this.loyaltyPrograms);
      }
      _deleteLoyaltyProgram(e) {
        var index = e.model.index;
        var lp = this.loyaltyPrograms[index];
        // this.notifyPath('list.' + e.model.index + 1, 'changed');
        var idToDel = this.loyaltyProgramIds[index];
        this.splice('loyaltyProgramIds', index, 1);       
        var copy = Object.assign({}, {loyaltyProgram})
        // var path = this.notifyPath(this.loyaltyPrograms[index]);
        // console.log(path);

        this.splice('loyaltyPrograms', index, 1, );

        // if (this.loyaltyPrograms.length > 0)
        //   this.loyaltyPrograms[this.loyaltyPrograms.length - 1].name = "Last";
        // this.notifyPath("loyaltyPrograms." + (this.loyaltyPrograms.length - 1) + ".name", this.loyaltyPrograms[this.loyaltyPrograms.length - 1].name);
      


      this.loyaltyProgramsCount = this.loyaltyProgramsCount - 1;
    }
    _increaseIndex(index) {
      var calIndex = index + 1;
      return calIndex;
    }
    isValidGuest() {
      var validData = [];
      var valid;
      var productLength = this.product.length;
      for (var i = 0; i < productLength; i++) {
        var roomsLength = this.product[i].rooms.length;
        for (var j = 0; j < roomsLength; j++) {
          validData[j] = this.shadowRoot.querySelector("#travelerInfo" + (i + 1) + (j + 1)).isValid();
        }
        for (var j = 0; j < roomsLength; j++) {
          if (validData[j] === false) {
            valid = false;
          } else {
            valid = true;
          }
        }
      }
      return valid;
    }
    isData() {
      var totalData = [];
      var totalProductPaxArray = [];
      var prodLen = this.product.length;
      for (var i = 0; i < prodLen; i++) {
        var data = [];
        var productPaxArray = [];
        var roomLen = this.product[i].rooms.length;
        for (var j = 0; j < roomLen; j++) {
          var productPax = {};
          productPax.ProductId = this.product[i].id;
          productPax.subProductId = this.product[i].rooms[j].id;
          data[j] = this.shadowRoot.querySelector("#travelerInfo" + (i + 1) + (j + 1)).getState(event);
          // console.log(data[j]);
          productPax.paxList = data[j];
          var productPax1 = productPax;
          productPaxArray[j] = productPax1;
        }
        totalProductPaxArray[i] = productPaxArray;
        totalData[i] = data;
      };
      console.log(totalProductPaxArray);
      console.log(totalData);

      var loyaltyTotalData = [];
      for (var i = 0; i < prodLen; i++) {
        if (this.product[i].allowLoyalty === true) {
          loyaltyTotalData[i] = this._loyaltyProgramData();
        }
      }
      // console.log(loyaltyTotalData);
      return totalData;
    }
    _loyaltyProgramData() {
      var loyaltyProgramObject = {};
      var loyaltyProgramArrayData = [];
      for (var i = 0; i < this.loyaltyPrograms.length; i++) {
        var loyaltyProgram = this.shadowRoot.querySelector("#tLoyaltyDatabase" + (i + 1));
        var loyaltyProgramArray = [];
        loyaltyProgramArray[0] = loyaltyProgram.shadowRoot.querySelector("#guestName" + (i + 1)).value;
        loyaltyProgramArray[1] = loyaltyProgram.shadowRoot.querySelector("#programName" + (i + 1)).value;
        loyaltyProgramArray[2] = loyaltyProgram.shadowRoot.querySelector("#programNumber" + (i + 1)).value;
        loyaltyProgramArrayData[i] = loyaltyProgramArray;
      }
      // console.log(loyaltyProgramArrayData);
      loyaltyProgramObject = JSON.stringify(loyaltyProgramArrayData);
      // console.log(loyaltyProgramObject);
      return loyaltyProgramArrayData;
    }

    ready() {
      super.ready();
      this.loyaltyPrograms = [];
      var ind = this.push('loyaltyPrograms', {
        loyaltyProgram: ""
      });
      setTimeout(() => {
        var loyaltyProgramID = this.shadowRoot.querySelector("#tLoyaltyDatabase" + ind).id;
        this.push('loyaltyProgramIds', loyaltyProgramID)
      }, 1);
      if (this.paxlist.length === 0) {
        this.paxlistAvailable = true;
        this.paxList = [];
      }
      this.guestInfo = this;
    }
    }

    window.customElements.define(TGuestInfo.is, TGuestInfo);
  </script>
</dom-module>