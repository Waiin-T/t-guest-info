<!--<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="bower_components/paper-item/paper-item.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-media-query/iron-media-query.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-button/paper-button.html">

<link rel="import" href="t-traveler-info.html">
<link rel="import" href="t-loyalty-program.html">
<link rel="import" href="t-product-summary.html">

<dom-module id="t-guest-info">
    <template>
  <style>
     :host {
        display: block;
        background-color: white;
        margin-left: 10px;
        margin-right: 10px;
    }
    
    #travelerInfo {
        margin-top: 40px;
        padding-left: 0px;
        padding-right: 0px;
    }
    
    #toolbar1 {
        background-color: transparent;
        border: 1px solid lightgray;
        margin: 10px;
        color: #478BD7;
        height: 60px;
    }
    
    #signInLink {
        color: #478BD7;
        text-decoration: none;
        font-size: 16px;
    }
    
    #tLoyaltyDatabase {
        margin-top: 2%;
    }
    
    @media (min-width: 320px) and (max-width: 380px) {
        #travelerInfo {
        margin-top: 40px;
        }
    
        #toolbarLotalty {
            background-color: var(--toolbar-background-color);
            width: 100%;
            height: 50px;
            margin-left: -11px;
            padding-right: 5px;
            font-size: 16px;
            margin-top: 20px;
        }
        .loyaltyDiv {
            width: 100%;
            margin-left: 10px;
            margin-right: 10px;
        }
        #lineBreakBetweenProduct {
            margin-top: 50px;
            clear: both;
            margin-left: -4px;
        }
        #productSummaryDiv {
            border: black solid 2px;
            height:500px;
            width: 100%;
            float: left;
        }
 .both {
    display: -webkit-box;
    display: -moz-box;
    display: -ms-flexbox;
    display: -webkit-flex;
    display: flex;
    -webkit-box-orient: vertical;
    -moz-box-orient: vertical;
    -webkit-flex-direction: column;
    -ms-flex-direction: column;
    flex-direction: column;
    /* optional */
    -webkit-box-align: start;
    -moz-box-align: start;
    -ms-flex-align: start;
    -webkit-align-items: flex-start;
    align-items: flex-start;
  }

  .both #roomTemplateDiv {
    -webkit-box-ordinal-group: 2;
    -moz-box-ordinal-group: 2;
    -ms-flex-order: 2;
    -webkit-order: 2;
    order: 2;
  }

  .both #productSummaryDiv {
    -webkit-box-ordinal-group: 1;
    -moz-box-ordinal-group: 1;
    -ms-flex-order: 1;
    -webkit-order: 1;
    order: 1;
  }

    }
    
    @media (min-width: 380px) and (max-width:767px) {
        #toolbarLotalty {
            background-color: var(--toolbar-background-color);
            width: 95%;
            height: 50px;
            margin-left: -11px;
            padding-right: 5px;
            font-size: 16px;
            margin-top: 20px;
        }
        .loyaltyDiv {
            width: 100%;
            margin-top: 10px;
            margin-left: 10px;
        }
        #lineBreakBetweenProduct {
            margin-top: 50px;
            clear: both;
            margin-left: -4px;
        }
        #productSummaryDiv {
            border: black solid 2px;
            height:500px;
            width: 100%;
            float: left;
            /* margin-left: 55px; */
            /* margin-top: 20px */
        }
        #roomTemplateDiv {
            float:left;
            width:100%;
        }
    }
    
    @media (min-width: 768px) and (max-width:1023px) {
        #toolbarLotalty {
            background-color: var(--toolbar-background-color);
            width: 97%;
            height: 50px;
            margin-left: -15px;
            padding-right: 5px;
            font-size: 16px;
            margin-top: 20px;
        }
        .loyaltyDiv {
            width: 100%;
            margin-left: 10px;
        }
        #lineBreakBetweenProduct {
            margin-top: 50px;
            clear: both;
            margin-left: 10px;
        }
        #productSummaryDiv {
            border: black solid 2px;
            height:500px;
            width: 30%;
            float: left;
            margin-left: 32px;
            margin-top: 5px
        }
        #roomTemplateDiv {
            float:left;
            width:65%;
        }
    }
    
    @media (min-width: 1024px) {
        .loyaltyDiv {
            width: 67%;
        }
        #toolbarLotalty {
            font-size: 16px;
            background-color: var(--toolbar-background-color);
            width: 97%;
            margin-left: 10px;
            margin-top: 20px;
            height: 50px;
        }
        #lineBreakBetweenProduct {
            margin-top: 50px;
            clear: both;
            margin-left: 10px;
        }
        #productSummaryDiv {
            border: black solid 2px;
            height:500px;
            width: 30%;
            float: left;
            margin-left: 55px;
            margin-top: 20px
        }
        #roomTemplateDiv {
            float:left;
            width:65%;
        }
        .both {
            width: 100%;
            display: flex;
        }
    }
</style>
    <!-- <iron-media-query query="(max-width: 380px)" query-matches="{{_smallMobileView}}"></iron-media-query>
    <iron-media-query query="(min-width: 380px) and (max-width:767px)" query-matches="{{_mobileView}}"></iron-media-query>
    <iron-media-query query="(min-width: 768px) and (max-width:1023px)" query-matches="{{_tabletView}}"></iron-media-query>
    <iron-media-query query="(min-width: 1024px) and (max-width: 1200px)" query-matches="{{_desktopView}}"></iron-media-query>
    <iron-media-query query="(min-width: 1200px)" query-matches="{{_largeDesktopView}}"></iron-media-query>
    <iron-media-query query="(max-width: 600px)" query-matches="{{mediumTablet}}"></iron-media-query>
    <iron-media-query query="(max-width: 767px)" query-matches="{{mobilePhone}}"></iron-media-query> -->
    <!-- <div class="item" smallMobileView$="{{_smallMobileView}}" desktopView$="{{_desktopView}}" tabletView$="{{_tabletView}}" mobileView$="{{_mobileView}}"> -->
      
      <app-toolbar id="toolbar1"><a href="#" id="signInLink">Sign in to make booking faster</a></app-toolbar>
      <br />

      <template is="dom-repeat" items="{{product}}" as="product" index-as="productNo" id="productTemplate">
          <div style="float:left;" class="both">
        <div id="roomTemplateDiv">
        <template is="dom-repeat" items="{{product.rooms}}" as="room" id="travelerTemplate">
          <t-traveler-info id="travelerInfo{{_increaseIndex(productNo)}}{{_increaseIndex(index)}}" class="travelerInfo" product-title="{{product.title}} {{_increaseIndex(index)}}"
            sub-title="{{room.name}} | {{room.criteria.traveler.adult}} {{_adultLabel(room.criteria.traveler.adult)}}, {{room.criteria.traveler.child}} {{_childLabel(room.criteria.traveler.child)}}" policy-List="{{room.policies}}"
            room-number="{{_increaseIndex(index)}}" pax-list="{{paxlist}}" option="[[option]]" resources="{{resources}}" adult-pax-count="[[room.criteria.traveler.adult]]"
            child-pax-count="[[room.criteria.traveler.child]]" guest-info="{{guestInfo}}" only-lead-pax-info="{{room.onlyLeadPaxInfo}}"
            pax-list-available="{{paxlistAvailable}}">
          </t-traveler-info>
          <br>
        </template>
    </div>
    <div id="productSummaryDiv">
        <slot name="tripSummary"></slot>
        </t-product-summary>
    </div>
    </div>
    <div id="loyaltyDiv{{productNo}}" class="loyaltyDiv" hidden$={{!product.allowLoyalty}}>
        <app-toolbar id="toolbarLotalty">{{_loyaltyProgram}}</app-toolbar>
        <div id="tLoyaltyProgram">
            <t-loyalty-program id="tLoyaltyDatabase{{_increaseIndex(productNo)}}" resources="{{resources}}" pax-list-available="{{paxlistAvailable}}" guest-info="{{guestInfo}}" pax-list="{{paxlist}}" index="{{_increaseIndex(productNo)}}">{{ item.loyaltyProgram }}</t-loyalty-program>
        </div>
    </div>
    <hr id="lineBreakBetweenProduct">
    </template>

    <br>
    <br>
    <!-- </div> -->
    </template>

    <script>
        /**
         * `t-guest-info`
         * 
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */
        class TGuestInfo extends Polymer.GestureEventListeners(Polymer.Element) {

            static get is() {
                return 't-guest-info';
            }

            static get properties() {
                    return {
                        /**
                         *Object to get t-guest-info component.
                         **/
                        guestInfo: Object,
                        /**
                         *Set the property for only lead pax info flag.
                         **/
                        onlyLeadPaxInfo: {
                            type: Boolean,
                            value: true
                        },
                        /**
                         *To set the product property.
                         **/
                        product: {
                            type: Object,
                            value: {}
                        },
                        /**
                         *Set the flag wheather paxList is available or not.
                         **/
                        paxlistAvailable: {
                            type: Boolean,
                            value: true
                        },
                        /**
                         *To set title property for room.
                         **/
                        productTitle: {
                            type: String,
                            value: 'Room'
                        },
                        /**
                         *To set subtitle property for room.
                         **/
                        subTitle: {
                            type: String,
                        },
                        /**
                         *Adult pax count set for a room.
                         **/
                        adultPaxCount: {
                            type: Number
                        },
                        /**
                         *Child pax count set for a room.
                         **/
                        childPaxCount: {
                            type: Number
                        },
                        /**
                         *To set the paxList property
                         **/
                        paxlist: {
                            type: Array,
                            value: [],
                            notify: true
                        },
                        /**
                         *To set the policy lis for a room.
                         **/
                        policyList: {
                            type: Array
                        },
                        /**
                         *To set the option for a room.
                         **/
                        option: {
                            type: Object,
                            value: {
                                "requiredField": [],
                                "requiredFieldForLeadPax": []
                            }
                        },
                        /**
                         *To set the resources.
                         **/
                        resources: {
                            type: Object
                        },
                        /**
                         *@private
                         *iron media query properties.
                         **/
                        _smallMobileView: {
                            type: Boolean,
                            value: false
                        },
                        /**
                         *@private
                         *iron media query properties.
                         **/
                        _mobileView: {
                            type: Boolean,
                            value: false
                        },
                        /**
                         *@private
                         *iron media query properties.
                         **/
                        _tabletView: {
                            type: Boolean,
                            value: false
                        },
                        /**
                         *@private
                         *iron media query properties.
                         **/
                        _desktopView: {
                            type: Boolean,
                            value: false
                        },
                        /**
                         *@private
                         *iron media query properties.
                         **/
                        _largeDesktopView: {
                            type: Boolean,
                            value: false
                        },
                        /**
                         *@private
                         **/
                        _adultTitle: String,
                        /**
                         *@private
                         **/
                        _adultPluralTitle: String,
                        /**
                         *@private
                         **/
                        _childTitle: String,
                        /**
                         *@private
                         **/
                        _childPluralTitle: String,
                        /**
                         *@private
                         **/
                        _loyaltyProgram: String,
                    };
                } //End of Properties.

            ready() {
                    super.ready();
                    this._setDefaultResourcesvalue();
                    if (this.paxlist.length === 0) {
                        this.paxlistAvailable = false;
                        this.paxList = [];
                    }
                    this.guestInfo = this;
                }
                /**
                 *Function to check validation of all fields for all rooms and products.
                 **/
            isValidGuest() {
                    var validRoomData = [];
                    var valid;
                    var productLength = this.product.length;
                    for (var i = 0; i < productLength; i++) {
                        var roomsLength = this.product[i].rooms.length;
                        var validData = [];
                        for (var j = 0; j < roomsLength; j++) {
                            validData[j] = this.shadowRoot.querySelector("#travelerInfo" + (i + 1) + (j + 1)).isValid();
                        }
                        for (var j = 0; j < roomsLength; j++) {
                            if (validData[j] === false) {
                                valid = false;
                            } else {
                                valid = true;
                            }
                        }
                        validRoomData[i] = validData;
                    }
                    return valid;
                }
                /**
                 *Function to collect data for all rooms and products.
                 **/
            isData() {
                    var totalData = [];
                    var totalProductPaxArray = [];
                    var prodLen = this.product.length;
                    for (var i = 0; i < prodLen; i++) {
                        var data = [];
                        var productPaxArray = [];
                        var roomLen = this.product[i].rooms.length;
                        for (var j = 0; j < roomLen; j++) {
                            var productPax = {};
                            productPax.ProductId = this.product[i].id;
                            productPax.subProductId = this.product[i].rooms[j].id;
                            data[j] = this.shadowRoot.querySelector("#travelerInfo" + (i + 1) + (j + 1)).getState(event);
                            // console.log(data[j]);
                            productPax.paxList = data[j];
                            var productPax1 = productPax;
                            productPaxArray[j] = productPax1;
                        }
                        totalProductPaxArray[i] = productPaxArray;
                        totalData[i] = data;
                    };
                    console.log(totalProductPaxArray);
                    console.log(totalData);
                    var loyaltyTotalData = [];
                    for (var i = 0; i < prodLen; i++) {
                        if (this.product[i].allowLoyalty === true) {
                            loyaltyTotalData[i] = this._getLoyaltyProgramData(i);
                        }
                    }
                    return totalData;
                }
                /**
                 *To handle puralization for subtitle.
                 **/
            _adultLabel(count) {
                    if (count === 1) {
                        return this._adultTitle;
                    } else {
                        return this._adultPluralTitle;
                    }
                }
                /**
                 *To handle the puralization for subtitle.
                 **/
            _childLabel(count) {
                    if (count === 1) {
                        return this._childTitle;
                    } else {
                        return this._childPluralTitle;
                    }
                }
                /**
                 *To increase the index of template by 1.
                 **/
            _increaseIndex(index) {
                    var calIndex = index + 1;
                    return calIndex;
                }
                /**
                 *Function to collect loyalty program data for all products.
                 **/
            _getLoyaltyProgramData(index) {
                var loyaltyProgramObject = {};
                var loyaltyProgramArrayData = [];
                var loyaltyProgramEle = this.shadowRoot.querySelector("#tLoyaltyDatabase" + (index + 1))
                var count = loyaltyProgramEle._deleteCount + loyaltyProgramEle._loyaltyPrograms.length;
                for (var i = 0; i < count; i++) {
                    if (loyaltyProgramEle.shadowRoot.querySelector("#div" + i) != null || loyaltyProgramEle.shadowRoot.querySelector("#div" + i) != undefined) {
                        var tLoyalty = loyaltyProgramEle.shadowRoot.querySelector("#div" + i).querySelector("#tLoyaltyProgramDataID");
                        var loyaltyProgram = {};
                        if (tLoyalty.shadowRoot.querySelector("#guestName" + i) != null) {
                            loyaltyProgram.GuestName = tLoyalty.shadowRoot.querySelector("#guestName" + i).value;

                            if (this.paxlistAvailable === false) {
                                loyaltyProgram.ProgramName = tLoyalty.shadowRoot.querySelector("#programNameInput" + i).value;
                            } else {
                                loyaltyProgram.ProgramName = tLoyalty.shadowRoot.querySelector("#programName" + i).value;
                            }
                            loyaltyProgram.ProgramNumber = tLoyalty.shadowRoot.querySelector("#programNumber" + i).value;
                        }
                        loyaltyProgramArrayData[i] = loyaltyProgram;
                    }
                }
                console.log(loyaltyProgramArrayData);
                return loyaltyProgramArrayData;
            }
            _setDefaultResourcesvalue() {
                this._adultTitle = this.resources.labels.adult.title ? this.resources.labels.adult.title : "Adult";
                this._adultPluralTitle = this.resources.labels.adult.titlep ? this.resources.labels.adult.titlep : "Adults";
                this._childTitle = this.resources.labels.child.title ? this.resources.labels.child.title : "Child";
                this._childPluralTitle = this.resources.labels.child.titlep ? this.resources.labels.child.titlep : "Children";
                this._loyaltyProgram = this.resources.loyaltyProgram.loyaltyProgram ? this.resources.loyaltyProgram.loyaltyProgram : "Loyalty program";
            }

        }

        window.customElements.define(TGuestInfo.is, TGuestInfo);
    </script>
</dom-module>