<link rel="import" href="pax-info.html">

<dom-module id="t-traveler-info">
    <template>
        <style>
                @media only screen 
                        and (min-device-width: 320px) 
                        and (max-device-width: 568px)
                        and (-webkit-min-device-pixel-ratio: 2) {
                        #title {
                                    font-size: 14px;
                                    width: 100%;
                                    margin-top: -7px;
                                    position: absolute;
                                    margin-left: -5px;
                                }
                        }
                @media (max-width:320px){
                    :host {
                        display: block;
                        background-color: white;
                        margin-left: 10px;
                        margin-right: 10px;
                    }
                    #toolbarRoom {
                        background-color: var(--toolbar-background-color);
                        width: 100%;
                        height: 50px;
                        margin-left: -14px;
                        padding-right: 5px;
                    }
                    #productPassengers {
                        width: 100%;
                        margin-left: 3px;
                    }
                    #title {
                        font-size: 14px;
                        width: 100%;
                        margin-top: 3px;
                        position: absolute;
                        margin-left: -5px;
                    }
                    #subTitle {
                        font-size: 13px;
                        color: var(--color-for-subTitle);
                        width: 100%;
                        margin-top: 15px;
                        margin-left: -6px;
                    }
                    #policyList {
                        font-size: 13px;
                        margin-left: -18px;
                        color: var(--color-for-policies);
                        margin-top: 10px;
                        font-family: roboto;
                    }
                    .closeIconAdult {
                        margin-top: 13%;
                        margin-left: -25px;
                        color: #A8A8A8;
                    }
                    .closeIconChild {
                        margin-top: 4%;
                        margin-left: -22px;
                        color: #A8A8A8;
                    }
                    .closeIconChooseGuest {
                        float: left;
                        position: absolute;
                        margin-top: -39px;
                        margin-left: 205px;
                        color: #A8A8A8;
                        visibility: hidden;
                    }
                        }
                @media (min-width: 321px) and (max-width: 380px) {
                    :host {
                        display: block;
                        background-color: white;
                        margin-left: 10px;
                        margin-right: 10px;
                    }
                    #toolbarRoom {
                        background-color: var(--toolbar-background-color);
                        width: 100%;
                        height: 50px;
                        margin-left: -14px;
                        padding-right: 5px;
                    }
                    #productPassengers {
                        width: 100%;
                        margin-left: 3px;
                    }
                    #title {
                        font-size: 14px;
                        width: 100%;
                        margin-top: -11px;
                        position: absolute;
                        margin-left: -5px;
                    }
                    #subTitle {
                        font-size: 13px;
                        color: var(--color-for-subTitle);
                        width: 100%;
                        margin-top: 15px;
                        margin-left: -6px;
                    }
                    #policyList {
                        font-size: 13px;
                        margin-left: -18px;
                        color: var(--color-for-policies);
                        margin-top: 10px;
                        font-family: roboto;
                    }
                    .closeIconAdult {
                        margin-top: 13%;
                        margin-left: -25px;
                        color: #A8A8A8;
                    }
                    .closeIconChild {
                        margin-top: 4%;
                        margin-left: -22px;
                        color: #A8A8A8;
                    }
                    .closeIconChooseGuest {
                        float: left;
                        position: absolute;
                        margin-top: -39px;
                        margin-left: 205px;
                        color: #A8A8A8;
                        visibility: hidden;
                    }
                }
                
                @media (min-width: 380px) and (max-width:767px) {
                    #toolbarRoom {
                        background-color: var(--toolbar-background-color);
                        width: 95%;
                        height: 50px;
                        margin-left: -14px;
                        padding-right: 5px;
                    }
                    #productPassengers {
                        width: 100%;
                        margin-left: 10px;
                    }
                    #title {
                        font-size: 14px;
                        width: 100%;
                        margin-top: -12px;
                        position: absolute;
                        margin-left: -5px;
                    }
                    #subTitle {
                        font-size: 13px;
                        color: var(--color-for-subTitle);
                        width: 100%;
                        margin-top: 15px;
                        margin-left: -6px;
                    }
                    #policyList {
                        font-size: 13px;
                        margin-left: -18px;
                        color: var(--color-for-policies);
                        margin-top: 10px;
                        font-family: roboto;
                    }
                    .closeIconAdult {
                        margin-top: 3%;
                        margin-left: -26px;
                        color: #A8A8A8;
                    }
                    .closeIconChild {
                        margin-top: 4%;
                        margin-left: -14px;
                        color: #A8A8A8;
                    }
                    .closeIconChooseGuest {
                        float: left;
                        position: absolute;
                        margin-top: -39px;
                        margin-left: 205px;
                        color: #A8A8A8;
                        visibility: hidden;
                    }
                }
                
                @media (min-width: 768px) and (max-width:1023px) {
                    #toolbarRoom {
                        background-color: var(--toolbar-background-color);
                        width: 100%;
                        height: 50px;
                        margin-left: -6px;
                    }
                    #productPassengers {
                        width: 100%;
                    }
                    #title {
                        font-size: 14px;
                        padding: 5px;
                    }
                    #subTitle {
                        font-size: 13px;
                        color: var(--color-for-subTitle);
                    }
                    #policyList {
                        font-size: 14px;
                        margin-left: -13px;
                        width: 100%;
                        color: var(--color-for-policies);
                        margin-top: 10px;
                        font-family: roboto;
                    }
                    .closeIconAdult {
                        margin-top: 4%;
                        margin-left: -15px;
                        color: #A8A8A8;
                    }
                    .closeIconChild {
                        margin-top: 4%;
                        margin-left: -15px;
                        color: #A8A8A8;
                    }
                    .closeIconChooseGuest {
                        float: left;
                        position: absolute;
                        margin-top: -39px;
                        margin-left: 205px;
                        color: #A8A8A8;
                        visibility: hidden;
                    }
                }
                
                @media (min-width: 1024px) {
                    #toolbarRoom {
                        background-color: var(--toolbar-background-color);
                        width: 100%;
                        margin-left: 10px;
                        margin-top: 20px;
                        height: 50px;
                        clear: both;
                    }
                    #productPassengers {
                        width: 100%;
                    }
                    #subTitle {
                        color: var(--color-for-subTitle);
                        font-size: 14px;
                        padding: 5px;
                    }
                    #title {
                        font-size: 16px;
                        padding: 5px;
                    }
                    #policyList {
                        color: var(--color-for-policies);
                        margin-top: 10px;
                        font-family: roboto;
                    }
                    /*#paxInfo, #closeIcon{
                            float: left;
                        }*/
                        .closeIconAdult,
                        .closeIconChild {
                            margin-top: 3%;
                            margin-left: 6px;
                            color: #A8A8A8;
                        }
                        .closeIconChooseGuest {
                            float: left;
                            position: absolute;
                            margin-top: -39px;
                            margin-left: 420px;
                            color: #A8A8A8;
                            visibility: hidden;
                        }
                }
                
                #paxInfoTemp {
                    padding-bottom: 15px;
                    float: left;
                    width: 108%;
                }
                
                #checkIcon {
                    margin-left: 10px;
                }
        </style>
        <iron-media-query query="(max-width: 380px)" query-matches="{{smallMobileView}}"></iron-media-query>
        <iron-media-query query="(min-width: 380px) and (max-width:767px)" query-matches="{{mobileView}}"></iron-media-query>
        <iron-media-query query="(min-width: 768px) and (max-width:1023px)" query-matches="{{tabletView}}"></iron-media-query>
        <iron-media-query query="(min-width: 1024px) and (max-width: 1200px)" query-matches="{{desktopView}}"></iron-media-query>
        <iron-media-query query="(min-width: 1200px)" query-matches="{{largeDesktopView}}"></iron-media-query> 

        <!-- <div class="item" smallMobileView$="{{smallMobileView}}" desktopView$="{{desktopView}}" tabletView$="{{tabletView}}" mobileView$="{{mobileView}}"
            largeDesktopView$="{{_largeDesktopViewOther(largeDesktopView)}}" _largeDesktopViewIE$="{{_largeDesktopViewIE(largeDesktopView)}}"> -->

            <div id="productPassengers">
                <app-toolbar id="toolbarRoom">
                    <div id="title">{{productTitle}}</div>
                    <div id="titleDash" hidden$={{_hideDashForMobileView}}> - </div>
                    <div id="subTitle">{{subTitle}}</div>
                </app-toolbar>

                <div id="policyList">
                    <template is="dom-repeat" items={{policyList}}>
                        <br>
                        <div>
                            <div style="float:left">
                                <img id="checkIcon" src="checkImage.svg" height="10" width="10">
                            </div>
                            <div style="margin-left:20px; margin-top:-11px">&nbsp {{item}}</div>
                        </div>
                    </template>
    </div>
    <template is="dom-repeat" items="{{_adPaxCountArray}}" id="adultPaxTemplate">
                    <div id="paxInfoTemp">
                        <pax-info id="adultPaxInfo{{rNumber}}{{_increaseIndex(index)}}" pax-list="{{_paxListAd}}" option="[[option]]" resources="{{resources}}"
                            index-array="{{_indexArray}}" index="{{_increaseIndex(index)}}" traveler-info="{{travelerInfo}}" adult-pax-count="{{adPaxCount}}"
                            pax-list-available="{{paxListAvailable}}" type="{{_adultPax}}" pax-data="{{item}}" r-number="{{rNumber}}" product-no="{{productNo}}" 
                            r-ad-pax-count-array="{{_adPaxCountArray}}" r-ch-pax-count-array="{{_chPaxCountArray}}" total-pax-list-array="{{totalPaxList}}" 
                            on-categorize="_handleDuplicateRecord" on-update="_updateList"></pax-info>
                        <div hidden$=[[_isCloseButtonHidden]]>
                            <paper-icon-button icon="close" id="closeIconAdult{{_increaseIndex(index)}}" class="closeIconChooseGuest" on-tap="_closePaxAdultInfo"></paper-icon-button>
                        </div>
                    </div>
                </template>

    <template is="dom-repeat" items="{{_chPaxCountArray}}" id="childPaxTemplate">
                    <div id="paxInfoTemp">
                        <pax-info id="childPaxInfo{{rNumber}}{{_increaseIndex(index)}}" pax-list="{{_paxListCh}}" option="[[option]]" resources="{{resources}}"
                            index-array="{{_indexArrayCh}}" type="{{_childPax}}" traveler-info="{{travelerInfo}}" child-pax-count="{{chPaxCount}}"
                            index="{{_increaseIndex(index)}}" r-number="{{rNumber}}" pax-data="{{item}}" pax-list-available="{{paxListAvailable}}" product-no="{{productNo}}"
                            r-ch-pax-count-array="{{_chPaxCountArray}}" r-ad-pax-count-array="{{_adPaxCountArray}}" total-pax-list-array="{{totalPaxList}}"
                            on-categorize="_handleDuplicateRecord"></pax-info>
                        <div>
                            <paper-icon-button icon="close" id="closeIconChild{{_increaseIndex(index)}}" class="closeIconChooseGuest" on-tap="_closePaxChildInfo"></paper-icon-button>
                        </div>
                    </div>
                </template>
    </div>
    <!-- </div> -->
    </template>

    <script>
        /**
         * `t-traveler-info`
         * 
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */
        class TTravelerInfo extends Polymer.GestureEventListeners(Polymer.Element) {
            static get is() {
                return 't-traveler-info';
            }
            static get properties() {
                return {
                    totalPaxList: Array,
                    /**
                     *Object to get t-traveler-info component.
                     **/
                    travelerInfo: {
                        type: Object,
                    },
                    /**
                     *Pass the current roonumber to pax-info.
                     **/
                    rNumber: {
                        type: Number
                    },
                    /**
                     *To set title property for room.
                     **/
                    productTitle: {
                        type: String,
                        value: 'Room'
                    },
                    /**
                     *To set subtitle property for room.
                     **/
                    subTitle: {
                        type: String,
                    },
                    /**
                     *To set the option property.
                     **/
                    option: {
                        type: Object,
                        value: {
                            "requiredField": [],
                            "requiredFieldForLeadPax": []
                        }
                    },
                    /**
                     *Adult pax count set for room.
                     **/
                    adPaxCount: {
                        type: Number,
                        value: ''
                    },
                    /**
                     *Child pax count set for room.
                     **/
                    chPaxCount: {
                        type: Number,
                        value: ''
                    },
                    /**
                     *To set the paxlist.
                     **/
                    paxlist: {
                        type: Array,
                    },
                    /**
                     *Set the flag where paxlist is available or not.
                     **/
                    paxListAvailable: {
                        type: Boolean,
                    },
                    /**
                     *To set policy list for a room.
                     **/
                    policyList: {
                        type: Array,
                    },
                    /**
                     *To set the resources.
                     **/
                    resources: {
                        type: Object
                    },
                    productNo: Number,
                    /**
                     *@private
                     *To set the iron media queries.
                     **/
                    smallMobileView: {
                        type: Boolean,
                        value: false
                    },
                    /**
                     *@private
                     *iron media query properties.
                     **/
                    mobileView: {
                        type: Boolean,
                        value: false
                    },
                    /**
                     *@private
                     *iron media query properties.
                     **/
                    tabletView: {
                        type: Boolean,
                        value: false
                    },
                    /**
                     *@private
                     *iron media query properties.
                     **/
                    desktopView: {
                        type: Boolean,
                        value: false
                    },
                    /**
                     *@private
                     *iron media query properties.
                     **/
                    largeDesktopView: {
                        type: Boolean,
                        value: false
                    },
                    _paxTempArray: {
                        type: Array,
                        value: []
                    },
                    /**
                     *To set the type adult for pax-info.
                     **/
                    _adultPax: {
                        type: String,
                        value: 'Adult'
                    },
                    /**
                     *To set the type child for pax-info.
                     **/
                    _childPax: {
                        type: String,
                        value: 'Child'
                    },
                    /**
                     *@private
                     *Array to get indexes of selected adult paxList.
                     *used for duplicate pax selected error message purpose.
                     **/
                    _indexArray: {
                        type: Array,
                        value: []
                    },
                    /**
                     *@private
                     *Array to get indexes of selected child paxlist.
                     *used for duplicate pax selected error message purpose.
                     **/
                    _indexArrayCh: {
                        type: Array,
                        value: []
                    },
                    /**
                     *@private
                     *Boolean property to hide dash for mobile view.
                     * which is present in between title and subtitle.
                     **/
                    _hideDashForMobileView: {
                        type: Boolean,
                        value: false
                    },
                    /**
                     *@private
                     *Array used for adult pax info.
                     **/
                    _adPaxCountArray: {
                        type: Array,
                        notify: true,
                        value: []
                    },
                    /**
                     *@private
                     *Array used for child pax info.
                     **/
                    _chPaxCountArray: {
                        type: Array,
                        notify: true,
                        value: []
                    },
                    /**
                     *@private
                     *To set the sorted paxlist for adult.
                     **/
                    _paxListAd: {
                        type: Array,
                    },
                    /**
                     *@private
                     *To set the sorted pax list for child.
                     **/
                    _paxListCh: {
                        type: Array,
                    },
                    /**
                     *@private
                     *Computed property to hide and show close button for adult.
                     **/
                    _isCloseButtonHidden: {
                        type: Boolean,
                        computed: '_lessThanEqualToOne(_adPaxCountArray.length, 1)'
                    },
                };
            }
            ready() {
                    super.ready();
                    var leadPaxInfo = this.onlyLeadPaxInfo;
                    if (leadPaxInfo === true) {
                        this.adPaxCount = 1;
                        this.chPaxCount = 0;
                    }
                    var adultPax = this.adPaxCount;
                    var childPax = this.chPaxCount;
                    this._adPaxCountArray = [];
                    for (var i = 0; i < adultPax; i++) {
                        var paxDataObject = {
                            "type": 'Adult',
                            "title": 0,
                            "firstName": '',
                            "lastName": '',
                            "email": '',
                            "countryCode": 0,
                            "contactNumber": '',
                        };
                        this.push('_adPaxCountArray', paxDataObject);
                    }
                    this._chPaxCountArray = [];
                    for (var i = 0; i < childPax; i++) {
                        var paxDataObject = {
                            "type": 'Child',
                            "title": 0,
                            "firstName": '',
                            "lastName": '',
                            "email": '',
                            "countryCode": 0,
                            "contactNumber": '',
                        };
                        this.push('_chPaxCountArray', paxDataObject);
                    }
                    this._hideDashForMobileViewMethod();
                    this._getAdultPaxList();
                    this._getChildPaxList();
                    this.travelerInfo = this;
                    this._indexArray = [];
                    this._indexArrayCh = [];
                }
                /**
                 *TO collect data from a room.
                 **/
            getState() {
                var tempArray = this._adPaxCountArray.concat(this._chPaxCountArray);
                this.totalPaxList[this.productNo].paxListObj[this.rNumber - 1].paxListObj = tempArray;
                return tempArray;
            }
            setState(paxList) {
                    var count = this.adPaxCount + this.chPaxCount;
                    var finalData = [];
                    for (var i = 0; i < count; i++) {
                        finalData[i] = this.paxList[i];
                    }
                    return finalData;
                }
                /**
                 *To fire valiadtion for a room.
                 **/
            isValid() {
                var paxValid;
                var validData = true;
                var count = this.adPaxCount + this.chPaxCount;
                for (var i = 0; i < count; i++) {
                    paxValid = this.shadowRoot.querySelectorAll('pax-info')[i]
                        .isValidPaxInfo();
                    if (paxValid === false) {
                        validData = false;
                        return validData;
                    }
                }

                return validData;
            }
            _updateList(e) {

            }
            _handleDuplicateRecord(e) {
                    var arrayList = [];
                    var a = this.dispatchEvent(new CustomEvent('listcategorize', {
                        detail: {
                            listcategorized: arrayList
                        }
                    }))
                    for (var i = 0; i < arrayList.length; i++) {
                        e.detail.categorized.push(arrayList[i]);
                    }
                }
                /**
                 *To hide the close button if adult is only one.
                 **/
            _lessThanEqualToOne(adultPaxCountArrayLength, hiddenButtonAdultNumber) {
                    if (this.rNumber === 1 && this.paxList.length === 0) {
                        return true;
                    } else {
                        return adultPaxCountArrayLength <= hiddenButtonAdultNumber;
                    }
                }
                /**
                 *To hide dash in between title and subtitle at mobileview.
                 **/
            _hideDashForMobileViewMethod() {
                if (this.smallMobileView === true || this.mobileView === true) {
                    this._hideDashForMobileView = true;
                } else {
                    this._hideDashForMobileView = false;
                }
            }
            _checkReferenceforAdult(e) {
                var count = this.adPaxCount + this.chPaxCount;
                for (var i = 0; i < count; i++) {
                    if (this.shadowRoot.querySelectorAll('pax-info')[i].type === "Adult") {
                        if (this.shadowRoot.querySelectorAll('pax-info')[i].index === e.model.index + 1) {
                            return this.shadowRoot.querySelectorAll('pax-info')[i];
                        }
                    }
                }
            }
            _checkReferenceforChild(e) {
                var count = this.adPaxCount + this.chPaxCount;
                for (var i = 0; i < count; i++) {
                    if (this.shadowRoot.querySelectorAll('pax-info')[i].type === "Child") {
                        if (this.shadowRoot.querySelectorAll('pax-info')[i].index === e.model.index + 1) {
                            return this.shadowRoot.querySelectorAll('pax-info')[i];
                        }
                    }
                }
            }
            _toggleCloseButtonClass(ind, paxType) {
                    if (paxType === "Adult") {
                        this.shadowRoot.querySelector("#closeIconAdult" + ind).classList.remove("closeIconChooseGuest");
                        this.shadowRoot.querySelector("#closeIconAdult" + ind).classList.add("closeIconAdult");
                    }
                    if (paxType === "Child") {
                        this.shadowRoot.querySelector("#closeIconChild" + ind).classList.remove("closeIconChooseGuest");
                        this.shadowRoot.querySelector("#closeIconChild" + ind).classList.add("closeIconChild");
                    }
                }
                /**
                 *on click of close button for adult pax.
                 **/
            _closePaxAdultInfo(e) {
                    var adultPaxInfoVar = this._checkReferenceforAdult(e);
                    var firstName = adultPaxInfoVar.paxData.firstName;
                    if (this.paxListAvailable === false) {
                        var paxL = adultPaxInfoVar._loadPaxList(e);
                        var paxIndex = paxL.findIndex(x => x.firstName == firstName);
                    } else {
                        var paxIndex = this.paxList.findIndex(x => x.firstName == firstName);
                    }
                    var indexOfPax = this._indexArray.indexOf(paxIndex);
                    if (indexOfPax > -1) {
                        this._indexArray.splice(indexOfPax, 1);
                    }
                    adultPaxInfoVar._showChooseGuest = false;
                    adultPaxInfoVar._showChooseGuestDuplicateError = true;
                    adultPaxInfoVar._showPaxInfoFields = true;
                    adultPaxInfoVar._chooseGuestInvalid = false;
                    e.currentTarget.classList.add("closeIconChooseGuest");
                    e.currentTarget.classList.remove("closeIconAdult");
                    adultPaxInfoVar.chooseGuestValue = -1;
                }
                /**
                 *On click of close button of child pax.
                 **/
            _closePaxChildInfo(e) {
                    var childPaxInfoVar = this._checkReferenceforChild(e);
                    var firstName = childPaxInfoVar.paxData.firstName;
                    if (this.paxListAvailable === false) {
                        var paxL = childPaxInfoVar._loadPaxList(e);
                        var paxIndex = paxL.findIndex(x => x.firstName == firstName);
                    } else {
                        var paxIndex = this.paxList.findIndex(x => x.firstName == firstName);
                    }
                    var indexOfPax = this._indexArrayCh.indexOf(paxIndex);
                    if (indexOfPax > -1) {
                        this._indexArrayCh.splice(indexOfPax, 1);
                    }
                    childPaxInfoVar._showChooseGuest = false;
                    childPaxInfoVar._showChooseGuestDuplicateError = true;
                    childPaxInfoVar._showPaxInfoFields = true;
                    childPaxInfoVar._chooseGuestInvalid = false;
                    e.currentTarget.classList.add("closeIconChooseGuest");
                    e.currentTarget.classList.remove("closeIconChild");
                    childPaxInfoVar.chooseGuestValue = -1;
                }
                /**
                 *To increase the index of template by 1.
                 **/
            _increaseIndex(index) {
                    var calIndex = index + 1;
                    return calIndex;
                }
                /**
                 *To sort provided paxList as type adult.
                 **/
            _getAdultPaxList() {
                    if (this.paxList) {
                        var paxList = this.paxList;
                        var adults = paxList.filter(function(item) {
                            return item.type.toLowerCase() === 'adult';
                        });
                        this._paxListAd = adults;
                    }
                }
                /**
                 *To sort provided paxList as type child.
                 **/
            _getChildPaxList() {
                    if (this.paxList) {
                        var paxList = this.paxList;
                        var children = paxList.filter(function(item) {
                            return item.type.toLowerCase() === 'child';
                        });
                        this._paxListCh = children;
                    }
                }
                /**
                 * Function to set view of internet explorer.       
                 * */
            _largeDesktopViewIE(largeDesktopView) {
                    // Internet Explorer 6-11
                    var isIE = /*@cc_on!@*/ false || !!document.documentMode;
                    return isIE && largeDesktopView;
                }
                /**
                 * Function for desktop view for browsers other than internet explorer.
                 * */
            _largeDesktopViewOther(largeDesktopView) {
                // Internet Explorer 6-11
                var isIE = /*@cc_on!@*/ false || !!document.documentMode;
                return !isIE && largeDesktopView;
            }
        }

        window.customElements.define(TTravelerInfo.is, TTravelerInfo);
    </script>
</dom-module>