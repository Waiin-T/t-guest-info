<link rel="import" href="pax-info.html">
<link rel="import" href="pax-info-child.html">

<dom-module id="t-traveler-info">
    <template>
        <style>
            #toolbarRoom {
                background-color: var(--toolbar-background-color);
                width: 100%;
                margin-left: 10px;
                margin-top: 20px;
                height: 50px;
            }

            #productPassengers {
                width: 67%;
            }

            #subTitle {
                color: var(--color-for-subTitle);
                font-size: 14px;
                padding: 5px;
            }

            #title {
                font-size: 16px;
                padding: 5px;
            }

            #policyList {
                color: var(--color-for-policies);
                margin-top: 10px;
                font-family: roboto;
            }

            #checkIcon {
                margin-left: 10px;
            }
            /*#paxInfo, #closeIcon{
                float: left;
            }*/

            #closeIcon {
                margin-top: 4%;
                margin-left: 20px;
                color: #A8A8A8;
            }

            #paxInfoTemp {
                float: left;
                width: 96%;
            }
        </style>
        <iron-media-query query="(max-width: 380px)" query-matches="{{smallMobileView}}"></iron-media-query>
        <iron-media-query query="(min-width: 380px) and (max-width:767px)" query-matches="{{mobileView}}"></iron-media-query>
        <iron-media-query query="(min-width: 768px) and (max-width:1023px)" query-matches="{{tabletView}}"></iron-media-query>
        <iron-media-query query="(min-width: 1024px) and (max-width: 1200px)" query-matches="{{desktopView}}"></iron-media-query>
        <iron-media-query query="(min-width: 1200px)" query-matches="{{largeDesktopView}}"></iron-media-query>


        <div id="productPassengers">
            <app-toolbar id="toolbarRoom">
                <div id="title">{{title}}</div>
                <div id="titleDash" hidden$={{hideDashForMobileView}}> - </div>
                <div id="subTitle">{{subTitle}}</div>
            </app-toolbar>

            <div id="policyList">
                <template is="dom-repeat" items={{policyList}}>
                    <br>
                    <!--<iron-icon icon="check" id="checkIcon"></iron-icon>-->
                    <img id="checkIcon" src="checkImage.svg" height="10" width="10"> {{item}}
                </template>
            </div>
            <template is="dom-repeat" items="{{adultPaxCountArray}}">
                <div id="paxInfoTemp">
                    <pax-info id="adultPaxInfo{{_increaseIndex(index)}}" pax-list="{{paxlist}}" option="[[option]]" resource="{{resource}}" index="{{_increaseIndex(index)}}"
                        adult-pax-count="{{adultPaxCount}}">{{item}}</pax-info>
                    <div hidden$=[[_isCloseButtonHidden]]>
                        <paper-icon-button icon="close" id="closeIcon" on-tap="_closePaxAdultInfo"></paper-icon-button>
                    </div>
                </div>
            </template>
            <template is="dom-repeat" items="{{childPaxCountArray}}">
                <div id="paxInfoTemp">
                    <pax-info-child id="childPaxInfo{{_increaseIndex(index)}}" pax-list="{{paxlist}}" option="[[option]]" resource="{{resource}}"
                        index="{{_increaseIndex(index)}}"></pax-info-child>
                    <paper-icon-button icon="close" id="closeIcon" on-tap="_closePaxChildInfo"></paper-icon-button>
                </div>
            </template>

        </div>


    </template>

    <script>
        /**
         * `t-traveler-info`
         * 
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */
        class TTravelerInfo extends Polymer.Element {
            static get is() {
                return 't-traveler-info';
            }
            static get properties() {
                return {
                    smallMobileView: {
                        type: Boolean,
                        value: false
                    },
                    mobileView: {
                        type: Boolean,
                        value: false
                    },
                    tabletView: {
                        type: Boolean,
                        value: false
                    },
                    desktopView: {
                        type: Boolean,
                        value: false
                    },
                    largeDesktopView: {
                        type: Boolean,
                        value: false
                    },
                    hideDashForMobileView:{
                        type: Boolean,
                        // value: false
                        computed: '_hideDashForMobileView()'
                    },
                    option: {
                        type: Object,
                        value: {
                            "requiredField": [],
                            "requiredFieldForLeadPax": []
                        }
                    },
                    adultPaxCount: {
                        type: Number,
                    },
                    adultPaxCountArray: {
                        type: Array,
                    },
                    childPaxCount: {
                        type: Number,
                    },
                    childPaxCountArray: {
                        type: Array,
                    },
                    totalPaxCount: {
                        type: Array,

                    },
                    paxList: {
                        type: Object,
                        value: {
                            "membership": {}
                        }
                    },
                    product: {
                        type: Object,
                        value: {
                            "rooms": []
                        }
                    },
                    policyList: {
                        type: Array,
                    },
                    resource: {
                        type: Object
                    },
                    showCloseButton: {
                        type: Boolean,
                        value: false
                    },
                    _isCloseButtonHidden: {
                        type: Boolean,
                        computed: '_lte(adultPaxCountArray.length , 1)'
                    },
                };
            }
            isValid() {
                var adultValidation = this.isValidAdult();
                var childValidation = this.isValidChild();
                if (!(adultValidation && childValidation)) {
                    return false;
                } else {
                    return true;
                }
            }
            isValidAdult() {
                var adultPaxInfoArray = [];
                var validData = true;
                for (var i = 1; i <= this.adultPaxCount; i++) {
                    adultPaxInfoArray[i] = Polymer.dom(this.root).querySelector("#adultPaxInfo" + (i)).isValidPaxInfo();
                }
                for (var i = 1; i <= this.adultPaxCount; i++) {
                    if (adultPaxInfoArray[i] === true) {
                        validData = false;
                    }
                }
                if (validData === true) {
                    return true;
                } else {
                    return false;
                }
            }
            isValidChild() {
                var childPaxInfoArray = [];
                var validData = true;
                for (var i = 1; i <= this.childPaxCount; i++) {
                    childPaxInfoArray[i] = Polymer.dom(this.root).querySelector("#childPaxInfo" + (i)).isValidPaxInfoChild();
                }
                for (var i = 1; i <= this.childPaxCount; i++) {
                    if (childPaxInfoArray[i] === true) {
                        validData = false;
                    }
                }
                if (validData === true) {
                    return true;
                } else {
                    return false;
                }
            }
            submit(event) {
                var adultPaxDataArray = [];
                for (var i = 0; i < this.adultPaxCount; i++) {
                    adultPaxDataArray[i] = Polymer.dom(this.root).querySelector("#adultPaxInfo" + (i + 1)).adultData();
                }
                var childPaxDataArray = [];
                for (var i = 0; i < this.childPaxCount; i++) {
                    childPaxDataArray[i] = Polymer.dom(this.root).querySelector("#childPaxInfo" + (i + 1)).childData();
                }
                // var adultPaxDataObject = JSON.stringify(adultPaxDataArray);
                // var childPaxDataObject = JSON.stringify(childPaxDataArray);
                var paxDataObject = adultPaxDataArray.concat(childPaxDataArray);
                // console.log(paxDataObject);
            }
            getState() {

            }
            setState() {

            }
            _lte(adultPaxCountArrayLength, hiddenButtonAdultNumber) {
                return adultPaxCountArrayLength <= hiddenButtonAdultNumber;
            }
            _hideDashForMobileView(){
                if(this.smallMobileView === true && this.mobileView === true){
                    return true;
                }
            }
            _closeIconIfAdultIsOnlyOne() {
                var adultCount = this.adultPaxCount;
                if (adultCount === 1) {
                    this.showCloseButton = true;
                }
            }
            _closePaxAdultInfo(e) {
                this.splice('adultPaxCountArray', e.model.index, 1);
            }
            _closePaxChildInfo(e) {
                this.splice('childPaxCountArray', e.model.index, 1);
            }
            _increaseIndex(index) {
                var calIndex = index + 1;
                return calIndex;
            }
            ready() {
                super.ready();
                this._closeIconIfAdultIsOnlyOne();
                var adultPax = this.adultPaxCount;
                var childPax = this.childPaxCount;
                var totalPax = +adultPax + +childPax;
                var adultPaxCount1 = [];
                for (var i = 0; i < adultPax; i++) {
                    adultPaxCount1.push(i);
                }
                this.adultPaxCountArray = adultPaxCount1;
                var childPaxCount1 = [];
                for (var i = 0; i < childPax; i++) {
                    childPaxCount1.push(i);
                }
                this.childPaxCountArray = childPaxCount1;

            }
        }

        window.customElements.define(TTravelerInfo.is, TTravelerInfo);
    </script>
</dom-module>